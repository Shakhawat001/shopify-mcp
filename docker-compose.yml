version: '3.8'

services:
  # MCP Server
  shopify-mcp-server:
    build: .
    container_name: shopify-mcp
    restart: always
    ports:
      - "${SERVER_PORT:-38383}:38383"
    volumes:
      # Persist session data across container restarts
      - ./data:/app/data
    environment:
      # --- General ---
      PORT: 38383
      DATA_DIR: /app/data
      NODE_ENV: production
      
      # --- Shopify OAuth ---
      HOST: ${HOST}
      SHOPIFY_API_KEY: ${SHOPIFY_API_KEY}
      SHOPIFY_API_SECRET: ${SHOPIFY_API_SECRET}
      
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:38383/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
