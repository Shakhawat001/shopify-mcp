version: '3.8'

services:
  shopify-mcp-server:
    build: .
    container_name: shopify-mcp
    restart: always
    ports:
      # Allow host port override via env, default to 3000
      - "${SERVER_PORT:-3000}:3000"
    environment:
      # --- General ---
      PORT: 3000
      
      # --- Security (Required for SSE/n8n) ---
      MCP_SERVER_TOKEN: ${MCP_SERVER_TOKEN}
      
      # --- Shopify OAuth (Required for App Install) ---
      HOST: ${HOST} 
      SHOPIFY_API_KEY: ${SHOPIFY_API_KEY}
      SHOPIFY_API_SECRET: ${SHOPIFY_API_SECRET}
      
    # Healthcheck for Coolify/Docker auto-restart
    healthcheck:
      test: ["CMD", "wget", "-qO-", "http://localhost:3000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s
